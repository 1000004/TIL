### ch5 프로세스 관리
#### 프로세스의 개념
* 디스크에 실행파일 형태로 존재하던 프러그램이 메모리에 올라서 실행되기 시작하면 비로소 생명력을 갖는 프롯세스
* 잡(job)이라는 용어와 프로세스를 혼용해 사용
* 프로세스의 문맥이란? 프로세스가 현재 어떤 상태에서 수행되고 있는지 정확히 규명하기 위해 필요한 정보를 의미
* CPU를 다시 획득해 명령의 수행을 재개하는 시점이 되면 이전의 CPU 보유 시기에 어느 부분까지 명령을 수행했는지 직전 수행 시점의 정확한 상태 재현 필요
* 이때 정확한 재현을 위해 필요한 정보가 바로 프로세스의 문맥
* 프로세스의 문맥은 그 프로세스의 주소 공간(코드, 데이터, 스택 상태)을 비롯해 레지스터에 어떤 값을 가지고 있었는지와, 시스템콜 등을 통해 커널에서 수행한 일의 상태, 그 프로세스에 관해 커널이 관리하고 있는 각종 정보 등을 포함
* 프로세스의 문맥을 크게 ㅅ세가지
  * 하드웨어 문맥 : CPU의 수행 상태를 나타내는 것으로 프로그램 카운터 값고가 각종 레지스터에 저장하고 있는 값
  * 프로세스의 주소 공간 : 코드, 데이터, 스택으로 구성되는 자긱 자신만의 독자적인 주소 공간, 프로세스 주소 공간은 그 프로세스의 문맥을 결정 짖는 중요한 요소
  * 커널상의 문맥 : 운영체제는 프로세스를 관리하기 위한 자료구조를 유지 PCB와 커널스택이 이에 해당 프로세스의 문맥을 구성하는 중요
#### 프로세스의 상태
* 프로세스의 상태 실행, 준비, 봉쇄
* 실행 상태 : 프로세스가 CPU를 보유하고 기계어 명령을 실행학고 있는 상태
* 준비 상태 : 프로세스가 CPU만 보유하면 당장 명령을 실행할 수 있지만 CPU를 할당받지 못한 상태
* 봉쇄 상태 : CPU를 할당받더라도 당장 명령을 실행할 수 없는 프로세스의 상태
* 프로세스의 상태를 구분하는 이유는 컴퓨터의 자원을 효율적으로 관리하기 위함
* 프로세스 생성중이거나 종류중인 일시적 상태 시작(new) 상태, 완료(terminated) 상태
* 시작상태는 프로세스가 시작되어 그 프로세스를 위한 각종 자료구조는 생성되었지만 아직 메로리 획득을 승인 받지 못한 상태
* 완료 상태는 프로세스가 종료되었으나 운영체제가 그 프로세스와 관련된 자료구조를 완전히 정리되지 못한 상태
* 실행시킬 프로세스를 변경하기 위해 수행 중이던 프로세스의 문맥을 저장하고 새로운 프로세스의 문맥을 세팅하는 과정을 문맥교환
* CPU 제어권을 가진 프로세스가 입출력을 위해 봉쇄상태가 되면서 준비 상태에 있는 프로세스 중에서 CPU를 할당받을 프로세스를 선택한 후 실제로 CPU의 제어권을 넘겨받는 과정 : CPU 디스페치
* 비록 인터럽트 처리루틴이 직전에 실행중이던 프로세스와는 무관한 업무를 담고 있기는 하지만 인터럽트 처리를 우리는 편의상 직전 프로세스의 문맥에서 실행된 것으로 간주
* 경우에 따라서는 인터럽트 당한 프로세스에게 CPU를 다시 할당하지 않고, 입출력이 완료된 프로세스가 더 우선순위가 높은 프로세스인 경우 문맥교환을 통해 CPU 제어권을 이양
#### 프로세스 제어블록
* 프로세스 제어블록(PCB)이란? 운영체제가 시스템내의 프로세스들을 관리하기 위해 프로세스마다 유지하는 정보들을 담는 커널 내의 자료 구조
* PCB 구성 요소
  * 프로세스의 상태 - CPU를 할당해도 되는지 여부를 결정하기 위해 필요
  * 프로그램의 카운터의 값 - 다음에 수행할 명령의 위치를 가리킨다
  * CPU 레지스터의 값 - CPU 연산을 위해 현 시점에 레지스터에 어떤값을 저장하고 있는지 나타낸다.
  * CPU 스케줄링 정보,메모리 관리 정보 - 각각 그 프로세스의 CPU 스케줄링과 메모리 할당을 위해 필요한 정보
  * 자원 사용 정보 - 사용자에게 자원 사용 요금을 계산해 청구하는 등의 용도로 사용
  * 입출력 상태 정보 - 프로세스가 오픈한 파일 정보 등 프로세스의 입출력 관련 상태 정보
#### 프로세스를 스케줄링하기 위한 큐
* 준비 큐에 프로세스를 줄 세우는 방법은 CPU 스케줄링 방법에 따라 달라진다. 자세히[6장]
* 준비 큐 외에도 운영체제는 특정 자원을 기다리는 프로세스들을 줄 세우기 위한 자원별 **장치 큐**를 둔다
* 디스크 컨트롤러는 디스크 입출력 큐에 줄 서 있는 순서대로 프로세스들의 입출력 작업 수행
* 준비 큐, 장치 큐는 하드웨어 지원을 기다리는 프로세스들을 줄 세우기위해 필요한 것 소프트웨어 자원을 기다리는 경우에도 필요
* 프로세스가 공유 데이터를 사용하는 중에 다른 프로세스가 같은 데이터를 접근하면 데이터에 대한 일관성이 훼손
* 공유 데이터는 매 시점 하나의 프로세스만이 접근할 수 있도록 해야 한다
* 공유데이터에 접근 중인 프로세스가 준비 상태나 봉쇄 상태로 변경된 경우에도 새롭게 CPU를 할당받은 프로세스가 동일한 데이터에 접근하게 되면 데이터의 일관성이 깨질 수 있으므로 접근을 허락해서는 안 된다
* 공유 데이터라는 일종의 소프트웨어자원을 앞섯 접근 중인 프로세스가 다 사용하고 반납할 때까지는 다른 프로세스가 CPU를 할당 받았다고 하더라도 접근하지 말고 기다려야 하는 것
* 여러 프로세스가 공유 데이터에 동시에 접근하려고 할 경우 공유 데이터를 기다리는 큐에 줄 서게 하여 현재 그 데이터를 사용하고 있는 프로세스가 데이터를 반납하기 전까지는 접근하지 못하게 하고, 반납할 경우 큐에 줄 서 있는 순서대로 데이터 접근 권한을 주는 방법을 사용
* 프로세스의 상태 관리는 커널의 주소 영역 중 데이터 영역에 다양한 큐를 두어 수행
* 각 프로세스가 CPU를 기다리는지, 입출력을 기다리는지 등의 정보를 커널이 총체적으로 관리
* 작업 큐는 시스템 내의 모든 프로세스를 관리하기 위한 큐, 프로세스의 상태와 무관하게 현재 시스템내에 있는 모든 프로새스가 작업 큐에 속한다
* 작업 큐가 가장 넓은 개념이고 준비 큐와 장치 큐에 있는 프로세스들은 모두 작업 큐에 속해 있다
* 장치 큐는 각각의 자원마다 큐가 하나씩 존재하며, 여기서 큐헤더는 큐의 가장 앞부분
* 큐는 각 프로세스의 PCB를 연결 리스트 형태로 관리하며 포일터를 사용해 순서를 정한다
* 장치 큐에 속한 프로세스들은 봉쇄 상태에 있다가 해당 장치의 서비스를 받고 나서 장치 컨트롤러가 인터럽트를 발생시키면 준비 상태로 바뀌어 준비 큐로 이동
